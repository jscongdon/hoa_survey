services:
  app:
    build: .
    working_dir: /app
    volumes:
      - .:/app
      - hoasurvey-data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=file:/data/hoasurvey.db
      - NODE_ENV=development
      - NEXT_PUBLIC_APP_URL=http://localhost:3000
      # copy SMTP variables into env or use .env file
    command: >
      sh -c "npm install && npx prisma generate && npx prisma migrate deploy || true && npx prisma db push && npm run prisma:seed || true && npm run dev"

volumes:
  hoasurvey-data:
